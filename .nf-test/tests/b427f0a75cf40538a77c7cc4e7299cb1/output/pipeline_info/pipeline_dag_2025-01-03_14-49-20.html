<!--
  ~ Copyright 2013-2024, Seqera Labs
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<html>
<head>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
</head>
<body>
<pre class="mermaid" style="text-align: center;">
flowchart TB
    subgraph " "
    v6["sample_data_csv"]
    v7["reference_data_csv"]
    v71["n_ref_strains"]
    v72["n_ref_species"]
    v73["n_ref_genera"]
    v74["only_latin_binomial_refs"]
    v140["adapter_fasta"]
    v141["discard_trimmed_pass"]
    v142["save_trimmed_fail"]
    v143["save_merged"]
    v152["yml"]
    v153["hmm"]
    v169["mode"]
    v178["mode"]
    v234["file_list"]
    v235["save_numpy_matrix"]
    v236["save_csv"]
    v278["min_ref_ani"]
    v315[" "]
    v334[" "]
    v335["sort_bam"]
    v408["constant_sites"]
    v431["n_ref_closest"]
    v432["n_ref_closest_named"]
    v433["n_ref_context"]
    v455["proteins"]
    v456["prodigal_tf"]
    v495["min_core_genes"]
    v496["max_core_genes"]
    v509[" "]
    v510[" "]
    v511[" "]
    v512[" "]
    v513[" "]
    v514["compress"]
    v518["constant_sites"]
    v540["n_ref_closest"]
    v541["n_ref_closest_named"]
    v542["n_ref_context"]
    v558["Channel.from"]
    v564["mode"]
    v565["lineage"]
    v566["config_file"]
    v583["min_genes"]
    v584["max_genes"]
    v596[" "]
    v597[" "]
    v598[" "]
    v599[" "]
    v600[" "]
    v601["compress"]
    v605["constant_sites"]
    v615["Channel.of"]
    v618["Channel.fromPath"]
    v646["replace_names"]
    v647["sample_names"]
    v710["Channel.fromPath"]
    end
    subgraph PATHOGENSURVEILLANCE
    subgraph PREPARE_INPUT
    v8([SAMPLESHEET_CHECK])
    v32([SRATOOLS_FASTERQDUMP])
    v39([BBMAP_SENDSKETCH])
    v41([INITIAL_CLASSIFICATION])
    v56([FIND_ASSEMBLIES])
    v75([PICK_ASSEMBLIES])
    v100([DOWNLOAD_ASSEMBLIES])
    v120([COUNT_READS])
    v124([SUBSET_READS])
    v33(( ))
    end
    subgraph GENOME_ASSEMBLY
    v144([FASTP])
    v154([SPADES])
    v170([FLYE_NANOPORE])
    v179([FLYE_PACBIO])
    v186([FILTER_ASSEMBLY])
    v193([QUAST])
    v151(( ))
    end
    subgraph SKETCH_COMPARISON
    v208([TRIM_AND_SKETCH])
    v215([SOURMASH_SKETCH])
    v237([SOURMASH_COMPARE])
    end
    subgraph INITIAL_QC_CHECKS
    v247([FASTQC])
    v253([NANOPLOT])
    end
    subgraph VARIANT_ANALYSIS
    v279([ASSIGN_MAPPING_REFERENCE])
    v302([SEQKIT_SLIDING])
    subgraph REFERENCE_INDEX
    v313([PICARD_CREATESEQUENCEDICTIONARY])
    v316([SAMTOOLS_FAIDX])
    v320([BWA_INDEX])
    end
    subgraph ALIGN_READS
    v336([BWA_MEM])
    v345([PICARD_FORMAT])
    v349([SAMTOOLS_INDEX])
    end
    subgraph CALL_VARIANTS
    v365([MAKE_REGION_FILE])
    v371([GRAPHTYPER_GENOTYPE])
    v374([GRAPHTYPER_VCFCONCATENATE])
    v377([TABIX_TABIX])
    v380([BGZIP_MAKE_GZIP])
    v391([GATK4_VARIANTFILTRATION])
    v394([VCFLIB_VCFFILTER])
    v393(( ))
    v413(( ))
    v415(( ))
    end
    v399([VCF_TO_SNP_ALIGN])
    v409([IQTREE2_SNP])
    v401(( ))
    end
    subgraph CORE_GENOME_PHYLOGENY
    v434([ASSIGN_CONTEXT_REFERENCES])
    v447([BAKTA_BAKTADBDOWNLOAD])
    v457([BAKTA_BAKTA])
    v469([MAKE_GFF_WITH_FASTA])
    v478([PIRATE])
    v484([REFORMAT_PIRATE_RESULTS])
    v488([CALCULATE_POCP])
    v490([ALIGN_FEATURE_SEQUENCES])
    v492([RENAME_CORE_GENE_HEADERS])
    v497([SUBSET_CORE_GENES])
    v507([FILES_IN_DIR])
    v515([MAFFT_SMALL])
    v519([IQTREE2_CORE])
    v480(( ))
    v505(( ))
    v508(( ))
    v517(( ))
    end
    subgraph BUSCO_PHYLOGENY
    v543([ASSIGN_CONTEXT_REFERENCES])
    v559([BUSCO_DOWNLOAD])
    v567([BUSCO])
    v585([SUBSET_BUSCO_GENES])
    v594([FILES_IN_DIR])
    v602([MAFFT_SMALL])
    v606([IQTREE2_CORE])
    v563(( ))
    v592(( ))
    v595(( ))
    v604(( ))
    end
    v648([MULTIQC])
    v709([PREPARE_REPORT_INPUT])
    v712([MAIN_REPORT])
    v9(( ))
    v640(( ))
    v642(( ))
    v644(( ))
    v711(( ))
    v716(( ))
    end
    subgraph " "
    v42[" "]
    v76[" "]
    v77[" "]
    v97["ref_data_with_ncbi_acc"]
    v121[" "]
    v126["versions"]
    v145[" "]
    v146[" "]
    v147[" "]
    v148[" "]
    v149[" "]
    v155[" "]
    v156[" "]
    v157[" "]
    v158[" "]
    v159[" "]
    v160[" "]
    v167["spades_warnings"]
    v171[" "]
    v172[" "]
    v173[" "]
    v174[" "]
    v175[" "]
    v176[" "]
    v180[" "]
    v181[" "]
    v182[" "]
    v183[" "]
    v184[" "]
    v185[" "]
    v194[" "]
    v238[" "]
    v248[" "]
    v254[" "]
    v255[" "]
    v256[" "]
    v280[" "]
    v303[" "]
    v317["samtools_gzi"]
    v318[" "]
    v337[" "]
    v338[" "]
    v339[" "]
    v346[" "]
    v347[" "]
    v348[" "]
    v350[" "]
    v351[" "]
    v372[" "]
    v375[" "]
    v378[" "]
    v397["samples"]
    v403["removed_samps"]
    v414["vcf"]
    v418["results"]
    v435[" "]
    v458[" "]
    v459[" "]
    v460[" "]
    v461[" "]
    v462[" "]
    v463[" "]
    v464[" "]
    v465[" "]
    v466[" "]
    v485[" "]
    v486[" "]
    v489[" "]
    v498[" "]
    v525["pirate_aln"]
    v568[" "]
    v569[" "]
    v570[" "]
    v571[" "]
    v572[" "]
    v573[" "]
    v574[" "]
    v575[" "]
    v576[" "]
    v577[" "]
    v649[" "]
    v650[" "]
    v652["versions"]
    v713[" "]
    v714[" "]
    v715[" "]
    v717[" "]
    end
    v6 --> v8
    v7 --> v8
    v8 --> v9
    v9 --> v32
    v32 --> v9
    v32 --> v33
    v9 --> v39
    v39 --> v41
    v39 --> v9
    v39 --> v33
    v41 --> v42
    v41 --> v9
    v41 --> v33
    v9 --> v56
    v56 --> v9
    v56 --> v33
    v71 --> v75
    v72 --> v75
    v73 --> v75
    v74 --> v75
    v9 --> v75
    v75 --> v77
    v75 --> v76
    v75 --> v9
    v9 --> v97
    v9 --> v100
    v100 --> v9
    v100 --> v33
    v9 --> v120
    v120 --> v121
    v120 --> v9
    v9 --> v124
    v124 --> v9
    v124 --> v33
    v33 --> v126
    v140 --> v144
    v141 --> v144
    v142 --> v144
    v143 --> v144
    v9 --> v144
    v144 --> v149
    v144 --> v148
    v144 --> v147
    v144 --> v146
    v144 --> v145
    v144 --> v9
    v144 --> v151
    v152 --> v154
    v153 --> v154
    v151 --> v154
    v154 --> v160
    v154 --> v159
    v154 --> v158
    v154 --> v157
    v154 --> v156
    v154 --> v155
    v154 --> v186
    v154 --> v9
    v9 --> v167
    v169 --> v170
    v9 --> v170
    v170 --> v176
    v170 --> v175
    v170 --> v174
    v170 --> v173
    v170 --> v172
    v170 --> v171
    v170 --> v9
    v178 --> v179
    v9 --> v179
    v179 --> v185
    v179 --> v184
    v179 --> v183
    v179 --> v182
    v179 --> v181
    v179 --> v180
    v179 --> v9
    v186 --> v9
    v9 --> v193
    v193 --> v194
    v193 --> v9
    v9 --> v208
    v208 --> v9
    v9 --> v215
    v215 --> v9
    v234 --> v237
    v235 --> v237
    v236 --> v237
    v9 --> v237
    v237 --> v238
    v237 --> v9
    v9 --> v247
    v247 --> v248
    v247 --> v9
    v9 --> v253
    v253 --> v256
    v253 --> v255
    v253 --> v254
    v253 --> v9
    v278 --> v279
    v9 --> v279
    v279 --> v280
    v279 --> v9
    v9 --> v302
    v302 --> v303
    v302 --> v9
    v9 --> v313
    v313 --> v9
    v315 --> v316
    v9 --> v316
    v316 --> v318
    v316 --> v317
    v316 --> v9
    v9 --> v320
    v320 --> v9
    v334 --> v336
    v335 --> v336
    v9 --> v336
    v336 --> v339
    v336 --> v338
    v336 --> v337
    v336 --> v9
    v9 --> v345
    v345 --> v349
    v345 --> v348
    v345 --> v347
    v345 --> v346
    v345 --> v9
    v349 --> v351
    v349 --> v350
    v349 --> v9
    v9 --> v365
    v365 --> v9
    v9 --> v371
    v371 --> v374
    v371 --> v372
    v371 --> v9
    v374 --> v377
    v374 --> v375
    v374 --> v9
    v377 --> v378
    v377 --> v9
    v9 --> v380
    v380 --> v9
    v9 --> v391
    v391 --> v9
    v391 --> v393
    v393 --> v394
    v394 --> v399
    v394 --> v9
    v394 --> v413
    v394 --> v415
    v9 --> v397
    v399 --> v9
    v399 --> v401
    v399 --> v415
    v401 --> v403
    v408 --> v409
    v9 --> v409
    v409 --> v9
    v409 --> v415
    v413 --> v414
    v415 --> v418
    v431 --> v434
    v432 --> v434
    v433 --> v434
    v9 --> v434
    v434 --> v435
    v434 --> v9
    v447 --> v457
    v447 --> v9
    v455 --> v457
    v456 --> v457
    v9 --> v457
    v457 --> v466
    v457 --> v465
    v457 --> v464
    v457 --> v463
    v457 --> v462
    v457 --> v461
    v457 --> v460
    v457 --> v459
    v457 --> v458
    v457 --> v9
    v9 --> v469
    v469 --> v9
    v9 --> v478
    v478 --> v9
    v478 --> v480
    v480 --> v484
    v484 --> v488
    v484 --> v486
    v484 --> v485
    v484 --> v9
    v488 --> v489
    v488 --> v9
    v480 --> v490
    v490 --> v492
    v490 --> v9
    v492 --> v9
    v495 --> v497
    v496 --> v497
    v9 --> v497
    v497 --> v498
    v497 --> v9
    v497 --> v505
    v505 --> v507
    v507 --> v508
    v509 --> v515
    v510 --> v515
    v511 --> v515
    v512 --> v515
    v513 --> v515
    v514 --> v515
    v508 --> v515
    v515 --> v9
    v515 --> v517
    v518 --> v519
    v517 --> v519
    v519 --> v9
    v9 --> v525
    v540 --> v543
    v541 --> v543
    v542 --> v543
    v9 --> v543
    v543 --> v9
    v558 --> v559
    v559 --> v9
    v559 --> v563
    v564 --> v567
    v565 --> v567
    v566 --> v567
    v9 --> v567
    v563 --> v567
    v567 --> v577
    v567 --> v576
    v567 --> v575
    v567 --> v574
    v567 --> v573
    v567 --> v572
    v567 --> v571
    v567 --> v570
    v567 --> v569
    v567 --> v568
    v567 --> v9
    v583 --> v585
    v584 --> v585
    v9 --> v585
    v585 --> v9
    v585 --> v592
    v592 --> v594
    v594 --> v595
    v596 --> v602
    v597 --> v602
    v598 --> v602
    v599 --> v602
    v600 --> v602
    v601 --> v602
    v595 --> v602
    v602 --> v9
    v602 --> v604
    v605 --> v606
    v604 --> v606
    v606 --> v9
    v615 --> v9
    v618 --> v640
    v646 --> v648
    v647 --> v648
    v9 --> v648
    v640 --> v648
    v642 --> v648
    v644 --> v648
    v648 --> v650
    v648 --> v649
    v648 --> v9
    v648 --> v716
    v9 --> v652
    v9 --> v709
    v709 --> v712
    v710 --> v711
    v711 --> v712
    v712 --> v715
    v712 --> v714
    v712 --> v713
    v716 --> v717

</pre>
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true, maxTextSize: Number.MAX_SAFE_INTEGER, maxEdges: Number.MAX_SAFE_INTEGER });
</script>
</body>
</html>
